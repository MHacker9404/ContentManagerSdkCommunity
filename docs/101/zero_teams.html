<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Micro Focus Content Manager SDK 10.1: Microsoft Teams Integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygenBase.css" rel="stylesheet" type="text/css" />
<link href="doxyStylesheet.css" rel="stylesheet" type="text/css"/>
<link href="doxySidebarFixes.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mf_logo_white_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Micro Focus Content Manager SDK 10.1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('zero_teams.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Microsoft Teams Integration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md100">Two modes of operation</a><ul><li class="level2"><a href="#autotoc_md101">Edit manifest to remove client side mode</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md102">Components</a></li>
<li class="level1"><a href="#autotoc_md103">Requirements</a></li>
<li class="level1"><a href="#autotoc_md104">Server side architecture</a><ul><li class="level2"><a href="#autotoc_md105">Check in styles and places</a></li>
<li class="level2"><a href="#autotoc_md106">Creating the check in style and place for Teams</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md107">ServiceAPI</a></li>
<li class="level1"><a href="#autotoc_md108">Setup Script</a></li>
<li class="level1"><a href="#autotoc_md109">Microsoft protected APIs</a></li>
<li class="level1"><a href="#autotoc_md110">Conversation silent interval</a></li>
<li class="level1"><a href="#autotoc_md111">Setup instructions</a><ul><li class="level2"><a href="#autotoc_md112">ServiceAPI Authentication Permissions</a></li>
<li class="level2"><a href="#autotoc_md113">ServiceAPI Authentication Application ID</a></li>
<li class="level2"><a href="#autotoc_md114">ServiceAPI Authorized Client Applications</a></li>
</ul>
</li>
<li class="level1"><a href="#teams_manifests">Teams App Manifest</a></li>
<li class="level1"><a href="#autotoc_md115">Browser Cookies</a></li>
<li class="level1"><a href="#autotoc_md116">Email Link</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_doc_16___Microsoft_Teams_Integration"></a></p>
<h1><a class="anchor" id="autotoc_md100"></a>
Two modes of operation</h1>
<p>The Teams integration has two modes of operation, client and server side. It is possible to use the integration in either one or both of these modes. The ServiceAPI and Teams application manifest must be installed irrespective of which mode the integration is to be used in. If only the server side mode is required then follow the directions below to modify the manifest. If only the client side integration is required then EmailLink does not need to be configured.</p>
<h2><a class="anchor" id="autotoc_md101"></a>
Edit manifest to remove client side mode</h2>
<p>Once the manifest has been either manually created or generated using the script the client side integration with Channels and Chats can be remove by removing the contents of the configurableTabs property and leaving it as an empty array.</p>
<div class="fragment"><div class="line">&quot;configurableTabs&quot;: [ ],</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md102"></a>
Components</h1>
<p>The Teams integration is made up of three components, not all of which need to be configured depending on the level of functionality required. The components are:</p><ul>
<li>ServiceAPI,</li>
<li>Teams Application manifest, and</li>
<li>Email Link (only required for server side filing)</li>
</ul>
<h1><a class="anchor" id="autotoc_md103"></a>
Requirements</h1>
<p>The components listed above work together to provide the complete Teams integration. If the only part of the integration required are the client side components then only the ServiceAPI and Teams manifest are required, Email Link is required to support scheduled server side filing of chats, posts and files.</p>
<h1><a class="anchor" id="autotoc_md104"></a>
Server side architecture</h1>
<h2><a class="anchor" id="autotoc_md105"></a>
Check in styles and places</h2>
<p>The server side component of the Teams integration is managed using check in styles and check in places. Check in Styles and places have a one to many parent-child relationship, meaning one check in style may have zero or more check in places associated with it. The purpose of the check in style is to encapsulate a collection of properties required to create a record, the purpose of the check in place is to track the connection details and synchronization state for a particular application and user.</p>
<p>For example, there might be one check in style that specifies a record type and default settings required for a particular project or customer. This check in style may have linked to it many check in places for different users, some linked to email folders, some linked to Teams channels and others linked to teams users for filing Teams chats.</p>
<h2><a class="anchor" id="autotoc_md106"></a>
Creating the check in style and place for Teams</h2>
<p>The usual way to create check in styles and places for the teams server side integration is via the teams client side app. This will allow you to create a check in style, navigate to a channel or user and create a check in place for that channel or user. Check in places may be created via the SDK if there is a need to automate this process, for example if it is undesirable to install the client app in Teams. To create the Check in place:</p><ol type="1">
<li>find the appropriate check in style</li>
<li>use the Microsoft Graph API to get the details of the desired channel or user</li>
<li>create the check in place using <a class="el" href="class_t_r_i_m_1_1_s_d_k_1_1_checkin_style.html#af326b6ce89444633a31923951e8da533">CheckinStyle.FindOrCreatePlace</a></li>
</ol>
<p><b>NOTE:</b> The place Id must be structured correctly:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Place type   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Place Id   </th><th class="markdownTableHeadNone">Place id example    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ChannelPostsForServerProcessing   </td><td class="markdownTableBodyNone">All posts for a channel.   </td><td class="markdownTableBodyNone">{team-id}/channels/{channel-id}   </td><td class="markdownTableBodyNone"><code>dd8b1122-13f0-41df-923d-a407637b4047/channels/19:3te1ccfc9b6c4390be34f7b69439f57a@thread.tacv2</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ChannelDocsForServerProcessing   </td><td class="markdownTableBodyNone">All files for a channel.   </td><td class="markdownTableBodyNone">{team-id}/channels/{channel-id}   </td><td class="markdownTableBodyNone"><code>dd8b1122-13f0-41df-923d-a407637b4047/channels/19:3te1ccfc9b6c4390be34f7b69439f57a@thread.tacv2</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TeamsChatForServerProcessing   </td><td class="markdownTableBodyNone">All chats involving this user.   </td><td class="markdownTableBodyNone">users/{id}/chats/getAllMessages   </td><td class="markdownTableBodyNone"><code>users/98e82caf-9073-449d-9284-1bfad890e3d5/chats/getAllMessages</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DocsForServerProcessing   </td><td class="markdownTableBodyNone">All files owned by this user.   </td><td class="markdownTableBodyNone">users/{id}/drive/root   </td><td class="markdownTableBodyNone"><code>users/98e82caf-9073-449d-9284-1bfad890e3d5/drive/root</code>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md107"></a>
ServiceAPI</h1>
<p>The ServiceAPI must be installed and must have a valid HTTPS certificate, any HTTP errors will cause the Teams Integration to fail.</p>
<p>The ServiceAPI performs four functions within the integration:</p><ul>
<li>hosts the web application that is used to administer the Teams integration (at /CMServiceAPI/office/index.html?teamsadmin=1),</li>
<li>hosts the web application that is embedded in Teams as the posts, chat and files add-ins (at /CMServiceAPI/office/index.html),</li>
<li>provides the backend services to which the add-on communicates when reading from or writing to Content Manager, and</li>
<li>provides services that act as a proxy between the Add-in and the Microsoft Graph API for reading from and writing to Microsoft Graph API.</li>
</ul>
<h1><a class="anchor" id="autotoc_md108"></a>
Setup Script</h1>
<p>The simplest way to configure the Microsoft Teams Integration is to use the setup script, which will create:</p><ul>
<li>an Azure App,</li>
<li>a manifest for Teams, Office and Outlook integrations, and</li>
<li>sample authentication settings for the ServiceAPI hptrim.config. <br  />
</li>
</ul>
<p>To use the script:</p><ol type="1">
<li>install the <a href="https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest">Azure CLI</a></li>
<li><a href="https://raw.githubusercontent.com/content-manager-sdk/Community/master/docs/files/101/az_install.ps1">download</a> and run the script.</li>
</ol>
<p>More help running this script can be found in the video in this <a href="https://hprm.info/teams-and-office-installer/">post</a>.</p>
<h1><a class="anchor" id="autotoc_md109"></a>
Microsoft protected APIs</h1>
<p>The Microsoft Graph API services used to file either all messages in a channel or all chats for a user are <a href="https://docs.microsoft.com/en-us/graph/teams-protected-apis">protected</a>, this means that they may only used with approval from Microsoft. Prior to submitting this form the Azure App for the Teams integration must be created as the approval is given for a particular App. In the request form an answer to the 'why does your application need to access all messages in the tenant' question might be as simple as 'Our organisation is required for compliance reasons to archive all Teams posts in a corporate Record management system'.</p>
<h1><a class="anchor" id="autotoc_md110"></a>
Conversation silent interval</h1>
<p>The Teams integration groups user chats into conversations so that each conversation can be stored in a separate Record. To achieve this the integration assumes that a period of silence in a group chat indicates that particular conversation has finished. For example if users A, B and C are chatting in Teams and a period of time elapses with nothing being said the integration will assume that the next thing said is a new conversation and file it in a new Record. When filing chats manually it is possible to choose to file one or more of these contiguous conversations as a single record. To configure how long this silent time should be got to <code>System Options &gt; Email and chat &gt; Wait until the conversation has been silent for the specified time</code>.</p>
<h1><a class="anchor" id="autotoc_md111"></a>
Setup instructions</h1>
<h2><a class="anchor" id="autotoc_md112"></a>
ServiceAPI Authentication Permissions</h2>
<p>The ServiceAPI must be configured to use OpenId Connect authentication as described in the <a href="oidc.html#oidc_azuread">authentication section</a>. New permissions must be assigned to the Azure AD Application to support Teams, these are:</p><ul>
<li>Delegated:<ul>
<li>ChannelMessage.Read.All</li>
<li>ChannelSettings.Read.All</li>
<li>Chat.Read</li>
<li>ChatMember.Read</li>
<li>email</li>
<li>Files.Read</li>
<li>Files.Read.All</li>
<li>Files.ReadWrite.All</li>
<li>GroupMember.Read.All</li>
<li>Sites.ReadWrite.All</li>
<li>User.Read.All</li>
</ul>
</li>
<li>Application:<ul>
<li>ChannelMessage.Read.All</li>
<li>ChannelMember.Read.All</li>
<li>ChannelSettings.Read.All</li>
<li>Chat.Read.All</li>
<li>ChatMember.Read.All</li>
<li>Files.Read.All</li>
<li>Files.ReadWrite.All</li>
<li>TeamSettings.Read.All</li>
</ul>
</li>
</ul>
<p>To assign these permissions:</p><ul>
<li>open the Azure AD Application used for authenticating Teams</li>
<li>go to API permissions</li>
<li>select 'Add a permission'</li>
<li>select Microsoft Graph</li>
<li>choose either 'Delegated' or 'Application' permissions</li>
<li>find the permission and add it <br  />
</li>
<li>once you have added all the permissions select 'Grant admin consent' to consent to all permissions.</li>
</ul>
<h2><a class="anchor" id="autotoc_md113"></a>
ServiceAPI Authentication Application ID</h2>
<p>The Teams integration requires that the Application ID Uri in the Azure AD App include the domain name of your ServiceAPI server, this must be adjusted before installing the office integration manifests. To adjust the Application ID URI:</p><ol type="1">
<li>open the Azure App referenced from your ServiceAPI hptrim.config file,</li>
<li>go the 'Expose an API' page,</li>
<li>edit the Application ID URI field,</li>
<li>by default the Application ID URI will look something like this <code>api://2d89cb2b-3cb7-4c21-807e-029fdbfe74a7</code>,</li>
<li>edit the Application ID URI to include the name of your ServiceAPI server, for example <code>api://myserver.com/2d89cb2b-3cb7-4c21-807e-029fdbfe74a7</code>, then</li>
<li>Once you have modified this you will need to update the appIdURI property (case sensitive) in the ServiceAPI hptrim.config file.</li>
</ol>
<h2><a class="anchor" id="autotoc_md114"></a>
ServiceAPI Authorized Client Applications</h2>
<p>The Teams integration relies on single sign on from the Microsoft add-in framework. To allow this to work we need to register our add-in, this is done in the 'Expose an API section of the Azure App created previously. To register your add-in:</p><ol type="1">
<li>Add a Scope</li>
<li>name it <code>access_as_teams_user</code></li>
<li>fill in the fields with values you think are appropriate, for example:<ul>
<li><b>Admin consent display name:</b> CM Teams Tab.</li>
<li><b>Admin consent description:</b> Enable Teams to call the add-in's web APIs with the same rights as the current user.</li>
<li><b>User consent display name:</b> Teams can act as you.</li>
<li><b>User consent description:</b> Enable Teams to call the add-in's web APIs with the same rights that you have.</li>
</ul>
</li>
<li>save the scope</li>
<li>Add two client applications, each time selecting the scope you just added, the Client Id for each of the three are:<ul>
<li>1fec8e78-bce4-4aaf-ab1b-5451cc387264</li>
<li>5e3ce6c0-2b1f-4285-8d4b-75ee78787346</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="teams_manifests"></a>
Teams App Manifest</h1>
<p>The manifest's purpose is to notify Microsoft Teams of the presence of your add-in. Manifest files must be customised before upload to your Office 365 Admin. To prepare your manifest:</p><ul>
<li>download the <a href="https://raw.githubusercontent.com/content-manager-sdk/Community/master/docs/files/101/teams-addin-manifest-template.json">sample manifest</a>,</li>
<li><a href="https://www.guidgenerator.com/online-guid-generator.aspx">generate</a> a new Guid and replace [MANIFESTGUID] with this new Guid,</li>
<li>replace [SERVICEAPIURL] with your ServiceAPI Url</li>
<li>if you want to include a link to the Content Manager Web Client replace [WEBSITEURLATTR] with <code>"websiteUrl": "{YOUR WEB CLIENT URL]",</code></li>
<li>if you do not wish to include a link to the Content Manger Web client remove [WEBSITEURLATTR],</li>
<li>replace [APPCLIENTID] with the client id from the Azure Ad App</li>
<li>replace [APPIDURI] with the Application ID URI from the Azure Ad App</li>
<li>create a zip file called content-manager-teams.zip which contains:<ul>
<li>your manifest renamed to manifest.json</li>
<li>the image files <a href="https://raw.githubusercontent.com/content-manager-sdk/Community/aba15c6fe5d3b34af219aba0dd635704fe18f9a6/docs/files/101/color.png">color.png</a> and <a href="https://raw.githubusercontent.com/content-manager-sdk/Community/aba15c6fe5d3b34af219aba0dd635704fe18f9a6/docs/files/101/outline.png">outline.png</a></li>
</ul>
</li>
<li>upload the manifest from the Microsoft Teams Admin center</li>
</ul>
<h1><a class="anchor" id="autotoc_md115"></a>
Browser Cookies</h1>
<p>It may be that the Teams integration addin does not display after it has been uploaded, if this is the case ensure that all cookie blocking is disabled in your web browser.</p>
<h1><a class="anchor" id="autotoc_md116"></a>
Email Link</h1>
<p>Email Link serves two purposes in the Teams integration, to:</p><ol type="1">
<li>file all posts and/or files in selected Channels, and</li>
<li>file all chats for selected users.</li>
</ol>
<p>Email Link should be installed as usual, there must be a Microsoft authentication configuration for your Office 365 domain that is of type OAuth and has Teams selected. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
